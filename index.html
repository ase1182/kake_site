<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>描け！公式サイト</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:"Segoe UI",sans-serif;background:#f9f9f9;color:#333}
    header{background:linear-gradient(135deg,#ff6ec4,#7873f5);color:#fff;text-align:center;padding:2rem 1rem}
    header img{max-width:140px;margin-bottom:1rem}
    h1{font-size:2rem;margin-bottom:.3rem}
    main{padding:2rem 1rem;max-width:800px;margin:auto}
    section{background:#fff;border-radius:10px;padding:1.5rem;margin-bottom:2rem;box-shadow:0 2px 8px rgba(0,0,0,.05)}
    section h2{color:#5a45d5;margin-bottom:.5rem}
    a{color:#ff6ec4;font-weight:bold;text-decoration:none}
    footer{background:#eee;text-align:center;font-size:.9rem;padding:1rem;color:#666}
    #drawCanvas{
      position:absolute;
      top:0; left:0;
      width:100vw;
      height:100vh;
      pointer-events:auto;
      touch-action:none;
      z-index:9990;
    }
    #toolbox{
      position:fixed;bottom:1rem;left:50%;transform:translateX(-50%);
      background:#ffffffee;border-radius:1rem;box-shadow:0 2px 6px rgba(0,0,0,.2);
      display:flex;flex-wrap:wrap;gap:.6rem;padding:.6rem 1rem;z-index:9991;justify-content:center;align-items:center;
    }
    #toolbox button{border:none;border-radius:50%;width:40px;height:40px;font-size:1.2rem;display:flex;align-items:center;justify-content:center;background:#eee;color:#333;cursor:pointer;}
    #toolbox button.active{background:#ff6ec4;color:#fff}
    #toolbox input[type="color"],#toolbox input[type="range"]{height:30px;}
    #toolbox label{font-size:0.75rem;text-align:center;color:#666;}
  </style>
</head>
<body>

<header>
  <img src="images/logo.png" alt="描け！ロゴ">
  <h1>描け！</h1>
  <p>みんなで描く、みんなのアート</p>
</header>

<main>
  <section><h2>この企画について</h2><p>「描け！」は、来場者全員が自由にペンや絵の具で描きこめる参加型アート体験企画です。</p></section>
  <section><h2>日時・場所</h2><p>2025年◯月◯日（日）<br>◯◯大学 学園祭 ◯号館前スペース</p></section>
  <section><h2>参加方法</h2><p>手ぶらでOK！画材も用意しています。途中参加・途中退場も大歓迎！</p></section>
  <section><h2>SNSでシェアしよう</h2><p>#描けフェス をつけてXに投稿しよう！<br><a href="https://twitter.com/your_account" target="_blank">公式X</a></p></section>
</main>

<footer><small>© 2025 描け！公式企画</small></footer>

<canvas id="drawCanvas"></canvas>

<div id="toolbox">
  <button id="penBtn" title="ペン">✏️</button>
  <button id="eraserBtn" title="消しゴム">🧽</button>
  <label><input type="color" id="colorPicker" value="#333333"></label>
  <label><input type="range" id="thicknessSlider" min="1" max="30" value="4"></label>
  <button id="clearBtn" title="全消し">🗑️</button>
  <button id="saveBtn" title="保存">💾</button>
</div>

<script>
  const canvas = document.getElementById('drawCanvas');
  const ctx = canvas.getContext('2d');
  let drawing = false;
  let erasing = false;
  let lastX = 0, lastY = 0;
  let color = '#333';
  let thickness = 4;

  // --- resize時に内容を保持 ---
  function resizeCanvas() {
    // 現在の内容を一時保存
    const oldImage = ctx.getImageData(0, 0, canvas.width, canvas.height);

    // 新しいサイズを取得
    const newWidth  = Math.max(document.documentElement.scrollWidth,  document.documentElement.clientWidth,  window.innerWidth || 0);
    const newHeight = Math.max(document.documentElement.scrollHeight, document.documentElement.clientHeight, window.innerHeight || 0);

    // サイズ変更
    canvas.width = newWidth;
    canvas.height = newHeight;

    // 古い内容を復元（小さくした場合ははみ出た部分が切れる）
    ctx.putImageData(oldImage, 0, 0);
  }
  window.addEventListener('resize', resizeCanvas);
  window.addEventListener('scroll', resizeCanvas); // ページが動的に伸びた時も
  resizeCanvas();

  const penBtn = document.getElementById('penBtn');
  const eraserBtn = document.getElementById('eraserBtn');
  const clearBtn = document.getElementById('clearBtn');
  const saveBtn = document.getElementById('saveBtn');
  const colorPicker = document.getElementById('colorPicker');
  const thicknessSlider = document.getElementById('thicknessSlider');

  const setMode = (erase) => {
    erasing = erase;
    penBtn.classList.toggle('active', !erase);
    eraserBtn.classList.toggle('active', erase);
  };
  penBtn.addEventListener('click', () => setMode(false));
  eraserBtn.addEventListener('click', () => setMode(true));
  clearBtn.addEventListener('click', () => {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
  });
  saveBtn.addEventListener('click', () => {
    const link = document.createElement('a');
    link.download = 'drawing.png';
    link.href = canvas.toDataURL();
    link.click();
  });
  colorPicker.addEventListener('change', (e) => { color = e.target.value; });
  thicknessSlider.addEventListener('input', (e) => { thickness = parseInt(e.target.value); });
  setMode(false);

  // --- 描画イベント ---
  const getXY = (e) => {
    const t = e.touches ? e.touches[0] : e;
    // 描画位置はpageX/pageY（ページ全体の座標）
    return [t.pageX, t.pageY];
  };

  const startDrawing = (e) => {
    drawing = true;
    [lastX, lastY] = getXY(e);
    ctx.beginPath();
    ctx.moveTo(lastX, lastY);
  };

  const draw = (e) => {
    if (!drawing) return;
    e.preventDefault();
    const [x, y] = getXY(e);
    ctx.lineWidth = thickness;
    ctx.lineCap = 'round';
    ctx.globalCompositeOperation = erasing ? 'destination-out' : 'source-over';
    ctx.strokeStyle = erasing ? 'rgba(0,0,0,1)' : color;
    ctx.lineTo(x, y);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(x, y);
  };

  const stopDrawing = () => {
    drawing = false;
    ctx.beginPath();
  };

  canvas.addEventListener('mousedown', startDrawing);
  canvas.addEventListener('touchstart', startDrawing);
  canvas.addEventListener('mousemove', draw);
  canvas.addEventListener('touchmove', draw, { passive: false });
  canvas.addEventListener('mouseup', stopDrawing);
  canvas.addEventListener('touchend', stopDrawing);
</script>

</body>
</html>
